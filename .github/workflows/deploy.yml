name: ğŸ¥ Video Restreamer

on:
  # Allows manual triggering of the workflow from the GitHub UI
  workflow_dispatch:
    inputs:
      rtmp_url:
        description: 'RTMP destination URL (e.g., rtmp://server/app/key)'
        required: true
        type: string

jobs:
  restream:
    runs-on: ubuntu-latest
    
    # Optional: Configure job timeout to stop the stream after a set time (e.g., 6 hours)
    timeout-minutes: 360
    
    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ’¾ Install FFmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: ğŸ“¥ Download Logo File
        # Assuming 'live.png' is not in the repo, download a placeholder or replace with your actual file access.
        # If 'live.png' is in your repo root, you can skip this step.
        run: |
          # Replace this placeholder command with your actual method to get live.png
          # Example: wget https://example.com/live.png -O live.png
          echo "Placeholder for downloading live.png. Please ensure live.png is accessible."

      - name: ğŸš€ Start Restreaming
        # The 'timeout' command is used here to ensure the script stops gracefully 
        # after the job's `timeout-minutes` is reached, triggering SIGTERM.
        run: python restream.py
        env:
          # Use the input provided during manual run as the RTMP_URL
          RTMP_URL: ${{ github.event.inputs.rtmp_url }}
